# 阿里云多模态服务配置说明

## 功能概述

本系统集成了阿里云的多模态AI服务，提供高质量的多模态文档处理能力：

1. **阿里云OCR** - 高精度图片文字识别
2. **阿里云文档智能** - 专业表格提取和解析
3. **阿里云语音识别** - 高质量音频转文字
4. **视频处理** - 提取音频后转文字

## 阿里云服务优势

### 相比免费方案的优势

| 特性 | 免费方案 | 阿里云服务 |
|------|----------|------------|
| OCR准确率 | 85-90% | 95-98% |
| 表格提取 | 70-80% | 95-99% |
| 语音识别 | 90-95% | 98-99% |
| 处理速度 | 慢 | 快 |
| 稳定性 | 一般 | 高 |
| 支持格式 | 有限 | 丰富 |
| 服务保障 | 无 | 7x24 |
| 扩展性 | 受限 | 无限 |

## 配置说明

### 1. 获取阿里云AccessKey

1. 登录[阿里云控制台](https://console.aliyun.com/)
2. 进入"访问控制" → "用户"
3. 创建用户或使用现有用户
4. 为用户创建AccessKey
5. 记录 `AccessKey ID` 和 `AccessKey Secret`

### 2. 开通服务

#### 2.1 开通OCR服务

1. 进入[文字识别OCR控制台](https://ocr.console.aliyun.com/)
2. 点击"立即开通"
3. 选择"通用文字识别"服务
4. 查看定价和配额

#### 2.2 开通文档智能服务

1. 进入[文档智能控制台](https://docmind.console.aliyun.com/)
2. 点击"立即开通"
3. 选择"表格提取"服务
4. 查看定价和配额

#### 2.3 开通语音识别服务

1. 进入[语音识别控制台](https://nls-portal.console.aliyun.com/)
2. 点击"立即开通"
3. 选择"录音文件识别"服务
4. 查看定价和配额

### 3. 环境变量配置

在 `.env.local` 文件中添加以下配置：

```bash
# 阿里云配置
ALIBABA_CLOUD_ACCESS_KEY_ID=your_access_key_id
ALIBABA_CLOUD_ACCESS_KEY_SECRET=your_access_key_secret
ALIBABA_CLOUD_REGION_ID=cn-hangzhou

# 多模态配置
ENABLE_MULTIMODAL=true
USE_OCR=true
USE_TABLE_EXTRACTION=true
USE_VIDEO_SUBTITLE=true
USE_AUDIO_TRANSCRIPTION=true
USE_ALIYUN_SERVICES=true
```

### 4. 配置参数说明

| 参数 | 说明 | 默认值 | 可选值 |
|------|------|--------|--------|
| `ALIBABA_CLOUD_ACCESS_KEY_ID` | 阿里云AccessKey ID | 必填 | 您的AccessKey ID |
| `ALIBABA_CLOUD_ACCESS_KEY_SECRET` | 阿里云AccessKey Secret | 必填 | 您的AccessKey Secret |
| `ALIBABA_CLOUD_REGION_ID` | 阿里云区域ID | `cn-hangzhou` | 区域ID |
| `USE_ALIYUN_SERVICES` | 是否使用阿里云服务 | `true` | `true`, `false` |

### 5. 阿里云区域列表

| 区域ID | 区域名称 |
|--------|----------|
| cn-hangzhou | 华东1-杭州 |
| cn-shanghai | 华东2-上海 |
| cn-beijing | 华北2-北京 |
| cn-shenzhen | 华南1-深圳 |
| cn-guangzhou | 华南2-广州 |
| cn-chengdu | 西南1-成都 |
| cn-hongkong | 中国香港 |

## 安装依赖

```bash
pip install alibabacloud-ocr-api20210707
pip install alibabacloud-docmind-api20220729
```

## 使用方法

### 1. 图片OCR

**支持的格式：** PNG, JPEG, GIF, BMP

**使用方式：**
- 上传图片文件
- 系统自动调用阿里云OCR
- 提取文字内容并存储

**效果：**
- 中英文识别准确率95-98%
- 支持手写文字识别
- 支持表格识别
- 支持印章识别

### 2. 表格提取

**支持的格式：** Excel, CSV

**使用方式：**
- 上传表格文件
- 系统自动调用阿里云文档智能
- 提取表格数据并转换为Markdown

**效果：**
- 表格提取准确率95-99%
- 支持复杂表格结构
- 支持合并单元格
- 支持公式识别

### 3. 音频转文字

**支持的格式：** MP3, WAV, M4A, FLAC

**使用方式：**
- 上传音频文件
- 系统自动调用阿里云语音识别
- 转换为文字并存储

**效果：**
- 中文识别准确率98-99%
- 支持方言识别
- 支持多语言混合
- 支持说话人分离

### 4. 视频处理

**支持的格式：** MP4, AVI, MOV, MKV

**使用方式：**
- 上传视频文件
- 系统提取音频
- 调用阿里云语音识别
- 转换为文字并存储

**效果：**
- 语音识别准确率98-99%
- 支持时间戳
- 支持多语言
- 自动提取音频

## 定价说明

### OCR服务

| 服务 | 价格 | 免费额度 |
|------|------|----------|
| 通用文字识别 | 0.001元/次 | 1000次/月 |
| 高精度OCR | 0.002元/次 | 500次/月 |

### 文档智能服务

| 服务 | 价格 | 免费额度 |
|------|------|----------|
| 表格提取 | 0.01元/页 | 100页/月 |
| 文档解析 | 0.02元/页 | 50页/月 |

### 语音识别服务

| 服务 | 价格 | 免费额度 |
|------|------|----------|
| 录音文件识别 | 0.002元/分钟 | 60分钟/月 |
| 实时语音识别 | 0.005元/分钟 | 30分钟/月 |

## 代码位置

- **阿里云多模态处理器：** `src/core/aliyun_multimodal.py`
- **多模态处理器：** `src/core/multimodal_processor.py`
- **文档处理器：** `src/core/document_processor.py`
- **配置文件：** `src/config/settings.py`

## 使用示例

### Python代码示例

```python
from src.core.aliyun_multimodal import AliyunMultiModalProcessor

# 创建处理器
processor = AliyunMultiModalProcessor(
    access_key_id="your_access_key_id",
    access_key_secret="your_access_key_secret",
    region_id="cn-hangzhou"
)

# 处理图片
result = processor.process_image("screenshot.png")
print(result["text"])

# 处理表格
result = processor.process_table("data.xlsx")
for table in result["tables"]:
    print(table["markdown"])

# 处理音频
result = processor.process_audio("recording.mp3")
print(result["text"])

# 处理视频
result = processor.process_video("meeting.mp4")
print(result["text"])
```

## 切换服务

### 从免费方案切换到阿里云

1. 在 `.env.local` 中设置：
   ```bash
   USE_ALIYUN_SERVICES=true
   ALIBABA_CLOUD_ACCESS_KEY_ID=your_key_id
   ALIBABA_CLOUD_ACCESS_KEY_SECRET=your_key_secret
   ```

2. 重启后端服务

### 从阿里云切换到免费方案

1. 在 `.env.local` 中设置：
   ```bash
   USE_ALIYUN_SERVICES=false
   ```

2. 安装免费方案依赖：
   ```bash
   pip install pytesseract pillow openai-whisper
   ```

3. 安装Tesseract OCR

## 注意事项

1. **AccessKey安全**：不要将AccessKey提交到代码仓库
2. **费用控制**：注意监控使用量，避免超支
3. **配额限制**：注意免费额度限制
4. **网络要求**：需要稳定的网络连接
5. **服务可用性**：阿里云服务99.9%可用性

## 故障排查

### 问题1：AccessKey无效

**错误信息：** `AccessKey无效`

**解决方案：**
1. 检查AccessKey是否正确
2. 检查AccessKey是否有权限
3. 检查服务是否已开通

### 问题2：服务未开通

**错误信息：** `服务未开通`

**解决方案：**
1. 登录阿里云控制台
2. 开通相应服务
3. 等待服务生效

### 问题3：配额不足

**错误信息：** `配额不足`

**解决方案：**
1. 检查免费额度
2. 购买付费配额
3. 等待配额重置

## 更新日志

### v1.0.0 (2024-01-30)
- ✅ 集成阿里云OCR服务
- ✅ 集成阿里云文档智能服务
- ✅ 集成阿里云语音识别服务
- ✅ 支持视频处理
- ✅ 添加配置参数
- ✅ 支持服务切换